<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Salle Tramontane</title>
<style>
/* ----- R√©glage global ----- */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
}

/* ----- Arri√®re-plan ----- */
#background-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  animation: zoomBackground 20s infinite alternate ease-in-out;
}

/* Animation fluide de l'arri√®re-plan */
@keyframes zoomBackground {
  0% { transform: scale(1); filter: brightness(1); }
  50% { transform: scale(1.02); filter: brightness(1.1); }
  100% { transform: scale(1); filter: brightness(1); }
}

/* ----- Overlay doux pour une meilleure lisibilit√© ----- */
body::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.2));
  pointer-events: none;
  z-index: 0;
}

/* ----- Zone Date/Heure ----- */
.header {
  position: absolute;
  top: 20px; 
  left: 20px;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  border-radius: 10px;
  padding: 12px 22px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  z-index: 10;
}
.header p {
  margin: 5px 0;
  font-size: 1.6rem;
  font-weight: bold;
  color: #f1f1f1;
}

/* ----- Titre Principal ----- */
.title {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 2.4rem;
  font-weight: bold;
  text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
  color: #fff;
  background: rgba(0, 0, 0, 0.3);
  padding: 8px 20px;
  border-radius: 10px;
  z-index: 10;
}

/* ----- Conteneur Principal ----- */
.content {
  position: absolute;
  top: 120px;
  bottom: 40px; 
  left: 20px; 
  right: 20px;
  display: flex;
  justify-content: flex-end;
  align-items: flex-start;
  z-index: 10;
}

/* ----- Bloc R√©unions ----- */
.meetings {
  width: 100%;
  max-width: 550px;
  height: calc(100% - 50px);
  background: rgba(30, 30, 30, 0.85);
  backdrop-filter: blur(10px);
  border-radius: 14px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  padding: 20px;
  overflow-y: auto;
  color: #fff;
}

/* ----- Titre du Bloc R√©unions ----- */
.meetings h2 {
  margin-top: 0;
  font-size: 1.5rem;
  font-weight: bold;
  text-transform: uppercase;
  margin-bottom: 0.8rem;
  color: #fff;
  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
  padding-bottom: 5px;
}

/* ----- R√©duction des espacements avant et apr√®s "En cours" ----- */
.status-current {
  margin-top: 5px !important;  /* R√©duit l'espace au-dessus */
  margin-bottom: 5px !important; /* R√©duit l'espace en dessous */
  padding: 6px 12px; /* Ajuste l'int√©rieur */
  display: inline-block;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: bold;
  background-color: #28a745; /* Vert */
  color: white;
  animation: blink 1.5s infinite alternate;
}

/* Effet clignotant sur "En cours" */
@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

/* Ajustement global des sections */
.meetings h3 {
  margin-top: 10px;
  margin-bottom: 10px;
  font-size: 1.3rem;
}

/* ----- Cartes r√©unions ----- */
.meeting-item {
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  margin: 8px 0; /* R√©duction de l'espacement */
  padding: 12px;
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  flex-direction: column;
  position: relative;
}

.meeting-item h3 {
  margin: 0;
  font-size: 1.2rem;
  font-weight: bold;
  color: #f8f8f8;
}

.meeting-item p {
  font-size: 1rem;
  margin: 5px 0;
  color: #ddd;
}

/* R√©unions pass√©es avec opacit√© r√©duite */
.meeting-item.past {
  opacity: 0.75;
  color: #bbb;
  background-color: rgba(255, 255, 255, 0.08);
}

/* Boutons r√©union */
.meeting-item button {
  align-self: flex-start;
  background-color: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  color: white;
  padding: 10px 15px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: background-color 0.3s, transform 0.2s;
  margin-top: 8px;
}

.meeting-item button:hover {
  background-color: rgba(255, 255, 255, 0.4);
  color: black;
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(255, 255, 255, 0.4);
}

/* ----- Zone des Boutons ----- */
.footer-buttons {
  position: fixed;
  bottom: 20px; 
  left: 20px;
  display: flex; 
  gap: 12px;
  z-index: 10;
}

.footer-buttons button {
  padding: 12px 20px;
  font-size: 1rem;
  font-weight: bold;
  border: none;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.25);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease-in-out;
  text-transform: uppercase;
}

.footer-buttons button:hover {
  background: rgba(255, 255, 255, 0.5);
  color: black;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 255, 255, 0.4);
}

/* ----- Texte d'aide pour le plein √©cran (r√©duction de hauteur) ----- */
.exit-hint {
  position: fixed;
  bottom: 85px;
  left: 20px;
  z-index: 10;
  font-size: 0.9rem; /* R√©duction de la taille du texte */
  font-weight: bold;
  color: #fff;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 5px 15px; /* R√©duction du padding */
  border-radius: 8px; /* L√©g√®re r√©duction du border-radius */
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(4px);
  text-align: center;
  height: auto; /* Assurer que la hauteur s'ajuste automatiquement */
  min-height: 30px; /* Fixer une hauteur minimale si besoin */
  line-height: 1.2; /* Ajuster l'espacement du texte */
}

</style>
</head>
<body>
<div id="background-container"></div>

<!-- Date / Heure -->
<div class="header">
  <p id="current-date"></p>
  <p id="current-time"></p>
</div>

<!-- Titre principal -->
<div class="title">Salle de R√©union Tramontane</div>

<!-- Zone principale -->
<div class="content">
  <div class="meetings">
    <h2>R√©unions d'aujourd'hui</h2>
    <div id="meetings-container">Chargement des r√©unions...</div>
  </div>
</div>

<!-- Boutons d'action -->
<div class="footer-buttons">
  <button onclick="document.documentElement.requestFullscreen()">üî≤ Plein √©cran</button>
  <button onclick="document.exitFullscreen()">‚ùé R√©duire</button>
  <button onclick="fetchMeetings()">üîÑ Rafra√Æchir</button>
</div>

<!-- Phrase d'aide pour le plein √©cran -->
<div class="exit-hint">
  <p>üîî Maintenez <strong>√âchap</strong> pour quitter le mode plein √©cran</p>
</div>

<script>
  // ------ Mise √† jour de la date / heure ------
  function updateDateTime() {
    const now = new Date();
    document.getElementById('current-date').textContent =
      now.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('current-time').textContent = now.toLocaleTimeString('fr-FR');
  }
  setInterval(updateDateTime, 1000);
  updateDateTime();
// Variable pour stocker l'√©tat pr√©c√©dent des r√©unions
let previousMeetings = JSON.stringify([]);

// ------ (2) R√©cup√©ration et affichage des r√©unions ------
async function fetchMeetings() {
    const salle = window.location.pathname.split('/')[1] || 'tramontane';
    const response = await fetch(`/meetings.json?salle=${salle}&t=${Date.now()}`);
    try {
        const response = await fetch('meetings.json?t=' + Date.now());
        if (!response.ok) {
            throw new Error(`Erreur HTTP! Status: ${response.status}`);
        }

        const meetings = await response.json();
        if (!Array.isArray(meetings)) {
            throw new Error("Donn√©es invalides: le JSON doit √™tre un tableau.");
        }

        // Convertir les r√©unions en JSON pour comparaison
        const currentMeetings = JSON.stringify(meetings);

        // Comparaison de l'ancien √©tat avec le nouveau
        if (previousMeetings === currentMeetings) {
            console.log("Aucun changement d√©tect√©, pas de mise √† jour.");
            return; // Ne met pas √† jour l'affichage
        }

        // Mise √† jour de l'√©tat pr√©c√©dent
        previousMeetings = currentMeetings;

        // Mise √† jour de l'affichage
        updateMeetingsDisplay(meetings);
        
    } catch (error) {
        console.error("Erreur lors du chargement des r√©unions:", error);
        document.getElementById('meetings-container').innerHTML =
            '<p>Erreur de chargement des r√©unions.</p>';
    }
}

// Fonction pour mettre √† jour l'affichage des r√©unions
function updateMeetingsDisplay(meetings) {
    const container = document.getElementById('meetings-container');
    container.innerHTML = ''; // Effacer l'ancien affichage

    const now = new Date();

    const pastMeetings = [];
    const currentMeetings = [];
    const upcomingMeetings = [];

    // Tri des r√©unions selon leur √©tat
    meetings.forEach(m => {
        const start = new Date(m.Start);
        const end = new Date(m.End);

        if (end < now) {
            pastMeetings.push(m);
        } else if (start <= now && now < end) {
            currentMeetings.push(m);
        } else {
            upcomingMeetings.push(m);
        }
    });

    // Fonction pour cr√©er une carte de r√©union
    function createMeetingItem(meeting, category) {
        const start = new Date(meeting.Start);
        const end = new Date(meeting.End);
        const startTime = start.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        const endTime = end.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

        let extraInfo = '';
        if (category === 'En cours') {
            const diffMin = Math.floor((end - now) / 60000);
            extraInfo = `<p>‚è≥ Temps restant : ${diffMin} min</p>`;
        }

        return `
            <div class="meeting-item ${category === 'Termin√©e' ? 'past' : ''}">
                <h3>${meeting.Subject}</h3>
                <p>üïí ${startTime} - ${endTime}</p>
                ${extraInfo}
                <p>üë• Invit√©s : ${Array.isArray(meeting.Attendees) ? meeting.Attendees.join(', ') : meeting.Attendees}</p>
                ${meeting.IsOnline ? `<button onclick="window.open('${meeting.JoinUrl}', '_blank')">üìé Rejoindre</button>` : ''}
            </div>
        `;
    }

    // Ajout des sections si elles contiennent des r√©unions
if (currentMeetings.length > 0) {
    container.innerHTML += `<h4 class="status-current">üü¢ En cours</h4>`;
    currentMeetings.forEach(m => {
        container.innerHTML += createMeetingItem(m, 'En cours');
    });
}


    if (upcomingMeetings.length > 0) {
        container.innerHTML += `<h4>üîµ √Ä venir</h4>`;
        upcomingMeetings.forEach(m => {
            container.innerHTML += createMeetingItem(m, '√Ä venir');
        });
    }

    if (pastMeetings.length > 0) {
        container.innerHTML += `<h4>‚ö™ Termin√©es</h2>`;
        pastMeetings.forEach(m => {
            container.innerHTML += createMeetingItem(m, 'Termin√©e');
        });
    }
}

// Mise √† jour des r√©unions toutes les 10 secondes
setInterval(fetchMeetings, 10000);
fetchMeetings();


  // ------ Rotation al√©atoire d'arri√®re-plan toutes les 30 minutes ------
  const backgrounds = [
    'Image/iStock-1137376794.jpg',
    'Image/iStock-1512013316.jpg',
    'Image/iStock-2019872476.jpg',
    'Image/iStock-2154828608.jpg',
    'Image/iStock-2157915069.jpg',
    'Image/iStock-2162113462.jpg',
    'Image/iStock-2178301876.jpg',
    'Image/iStock-2186748328.jpg',
    'Image/iStock-2187797860.jpg',
    'Image/iStock-2188982874.jpg'
  ];

  function changeBackground() {
    const randomImage = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    document.getElementById('background-container').style.backgroundImage = `url('${randomImage}')`;
  }
  
  setInterval(changeBackground, 1800000); // 30 min
  changeBackground();
</script>

</body>
</html>
